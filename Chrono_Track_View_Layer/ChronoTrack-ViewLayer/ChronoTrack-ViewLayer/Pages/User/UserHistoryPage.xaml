<!-- =========  UserHistoryPage.xaml  ========= -->
<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:components="clr-namespace:ChronoTrack_ViewLayer.Components"
             xmlns:local="clr-namespace:ChronoTrack_ViewLayer.Pages.User"
             xmlns:converters="clr-namespace:ChronoTrack_ViewLayer.Pages.User"
             x:Class="ChronoTrack_ViewLayer.Pages.User.UserHistoryPage"
             BackgroundColor="#F4F5F9">

    <!-- Main grid ---------------------------------------------------------------->
    <Grid RowDefinitions="Auto,*" x:Name="RootGrid" RowSpacing="0">

        <!-- Header -->
        <components:HeaderComponent Grid.Row="0"
                                    Style="{StaticResource HeaderStyle}" />

        <!-- Scrollable body -->
        <ScrollView Grid.Row="1">
            <Grid Padding="32"
                  RowDefinitions="Auto,*"
                  Margin="0,24,0,0">

                <!-- Page title -->
                <Label Text="Attendance History"
                       FontSize="28"
                       FontAttributes="Bold"
                       TextColor="#1A2B45"
                       Margin="0,0,0,24"/>

                <!-- Card -->
                <Grid Grid.Row="1" RowDefinitions="*">

                    <Border StrokeShape="RoundRectangle 16"
                            BackgroundColor="White"
                            Padding="0"
                            VerticalOptions="Fill"
                            HorizontalOptions="Fill"
                            Margin="0,0,0,20">

                        <Grid RowDefinitions="Auto,Auto,*,Auto">

                            <!-- Card header (title + date) -->
                            <Grid Grid.Row="0"
                                  ColumnDefinitions="*,Auto"
                                  Padding="24,24,24,12">

                                <Label Grid.Column="0"
                                       Text="Attendance Records"
                                       FontSize="20"
                                       FontAttributes="Bold"
                                       TextColor="#111827"
                                       VerticalOptions="Center"/>

                                <Border Grid.Column="1"
                                        Padding="12,8"
                                        StrokeShape="RoundRectangle 6"
                                        BackgroundColor="#F3F4F6">
                                    <HorizontalStackLayout Spacing="8">
                                        <Image Source="calendar.png"
                                               WidthRequest="16"
                                               HeightRequest="16"/>
                                        <Label Text="03 March 2025"
                                               FontSize="14"
                                               TextColor="#111827"
                                               VerticalOptions="Center"/>
                                    </HorizontalStackLayout>
                                </Border>
                            </Grid>

                            <!-- Divider -->
                            <BoxView Grid.Row="1"
                                     Color="#E5E7EB"
                                     HeightRequest="1"
                                     HorizontalOptions="Fill"
                                     Margin="24,0"/>

                            <!-- Table --------------------------------------------------->
                            <Grid Grid.Row="2" RowDefinitions="Auto,*">

                                <!-- Column headers -->
                            <Grid Grid.Row="0"
                                      ColumnDefinitions="1.5*,1.5*,0.8*,1.2*,1*,1*,1.5*"
                                      Padding="24,16"
                                      BackgroundColor="#F9FAFB">

                                <Label Grid.Column="0" Text="Attendance ID" FontAttributes="Bold" TextColor="#111827" FontSize="14" VerticalOptions="Center"/>
                                <Label Grid.Column="1" Text="Date"           FontAttributes="Bold" TextColor="#111827" FontSize="14" VerticalOptions="Center"/>
                                <Label Grid.Column="2" Text="Day"            FontAttributes="Bold" TextColor="#111827" FontSize="14" VerticalOptions="Center"/>
                                <Label Grid.Column="3" Text="Check-in (Local)"  FontAttributes="Bold" TextColor="#111827" FontSize="14" VerticalOptions="Center"/>
                                <Label Grid.Column="4" Text="Check-out (Local)" FontAttributes="Bold" TextColor="#111827" FontSize="14" VerticalOptions="Center"/>
                                <Label Grid.Column="5" Text="Work hours"     FontAttributes="Bold" TextColor="#111827" FontSize="14" VerticalOptions="Center"/>
                                <Label Grid.Column="6" Text="Status"         FontAttributes="Bold" TextColor="#111827" FontSize="14" VerticalOptions="Center"/>
                            </Grid>

                            <!-- Data rows -->
                            <CollectionView Grid.Row="1"
                                                x:Name="HistoryCollectionView"
                                                SelectionMode="None"
                                                VerticalOptions="Fill"
                                                Margin="0,1,0,0">
                                <CollectionView.ItemsLayout>
                                    <LinearItemsLayout Orientation="Vertical"
                                                           ItemSpacing="0"/>
                                </CollectionView.ItemsLayout>

                                <!-- Empty state -->
                                <CollectionView.EmptyView>
                                    <VerticalStackLayout VerticalOptions="Center"
                                                             HorizontalOptions="Center"
                                                             Margin="0,40">
                                        <Image Source="empty_state.png"
                                                   HeightRequest="100"
                                                   WidthRequest="100"
                                                   Opacity="0.5"/>
                                        <Label Text="No attendance records found"
                                                   TextColor="#6B7280"
                                                   Margin="0,16,0,0"/>
                                    </VerticalStackLayout>
                                </CollectionView.EmptyView>

                                <!-- Row template -->
                                <CollectionView.ItemTemplate>
                                    <DataTemplate x:DataType="local:HistoryItem">
                                        <Grid ColumnDefinitions="1.5*,1.5*,0.8*,1.2*,1*,1*,1.5*"
                                                  Padding="24,16"
                                                  BackgroundColor="{Binding IsEvenRow,
                                                                           Converter={StaticResource BoolToColorConverter}}">

                                            <Label Grid.Column="0" Text="{Binding AttendanceId}"        TextColor="#111827" FontSize="14" VerticalOptions="Center"/>
                                            <Label Grid.Column="1" Text="{Binding FormattedDate}"       TextColor="#111827" FontSize="14" VerticalOptions="Center"/>
                                            <Label Grid.Column="2" Text="{Binding Day}"                 TextColor="#111827" FontSize="14" VerticalOptions="Center"/>
                                            <Label Grid.Column="3" Text="{Binding FormattedCheckInTime}" TextColor="#111827" FontSize="14" VerticalOptions="Center"/>
                                            <Label Grid.Column="4" Text="{Binding FormattedCheckOutTime}"TextColor="#111827" FontSize="14" VerticalOptions="Center"/>
                                            <Label Grid.Column="5" Text="{Binding FormattedDuration}"    TextColor="#111827" FontSize="14" VerticalOptions="Center"/>

                                            <Border Grid.Column="6"
                                                        StrokeShape="RoundRectangle 6"
                                                        Padding="12,4"
                                                        HorizontalOptions="Start"
                                                        VerticalOptions="Center"
                                                        BackgroundColor="{Binding Status,
                                                                                 Converter={StaticResource StatusColorConverter}}">
                                                <Label Text="{Binding Status}"
                                                           TextColor="#111827"
                                                           FontSize="14"
                                                           HorizontalOptions="Center"
                                                           VerticalOptions="Center"/>
                                            </Border>
                                        </Grid>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </Grid>

                        <!-- Pagination footer --------------------------------------->
                            <Grid Grid.Row="3"
                                  Padding="24,16"
                                  BackgroundColor="#F9FAFB"
                                  RowDefinitions="Auto,Auto">

                                <HorizontalStackLayout Grid.Row="0"
                                                       HorizontalOptions="Center"
                                                       Spacing="4">
                                    <Label Text="Showing"               TextColor="#6B7280"/>
                                    <Label Text="{Binding StartItem}"   TextColor="#111827" FontAttributes="Bold" Margin="5,0"/>
                                    <Label Text="to"                    TextColor="#6B7280"/>
                                    <Label Text="{Binding EndItem}"     TextColor="#111827" FontAttributes="Bold" Margin="5,0"/>
                                    <Label Text="of"                    TextColor="#6B7280"/>
                                    <Label Text="{Binding TotalItems}"  TextColor="#111827" FontAttributes="Bold" Margin="5,0"/>
                                    <Label Text="entries"               TextColor="#6B7280"/>
                                </HorizontalStackLayout>

                                <HorizontalStackLayout Grid.Row="1"
                                                       HorizontalOptions="Center"
                                                       Spacing="8"
                                                       Margin="0,20,0,0">
                                    <Button Text="Previous" BackgroundColor="#F3F4F6" TextColor="#374151"
                                            Clicked="OnPreviousClicked"
                                            HeightRequest="40" WidthRequest="120" FontSize="14"/>
                                    <Button Text="1"  BackgroundColor="#0066FF" TextColor="White"
                                            Clicked="OnPageNumberClicked" HeightRequest="40" WidthRequest="40" FontSize="14"/>
                                    <Button Text="2"  BackgroundColor="#F3F4F6" TextColor="#374151"
                                            Clicked="OnPageNumberClicked" HeightRequest="40" WidthRequest="40" FontSize="14"/>
                                    <Button Text="3"  BackgroundColor="#F3F4F6" TextColor="#374151"
                                            Clicked="OnPageNumberClicked" HeightRequest="40" WidthRequest="40" FontSize="14"/>
                                    <Label Text="â€¦" TextColor="#374151" VerticalOptions="Center" FontSize="14"/>
                                    <Button Text="8"  BackgroundColor="#F3F4F6" TextColor="#374151"
                                            Clicked="OnPageNumberClicked" HeightRequest="40" WidthRequest="40" FontSize="14"/>
                                    <Button Text="Next" BackgroundColor="#F3F4F6" TextColor="#374151"
                                            Clicked="OnNextClicked"
                                            HeightRequest="40" WidthRequest="120" FontSize="14"/>
                                </HorizontalStackLayout>
                            </Grid>
                        </Grid>
                    </Border>
                </Grid>
            </Grid>
        </ScrollView>
    </Grid>

    <!-- Resources -->
                        <ContentPage.Resources>
                            <converters:StatusColorConverter  x:Key="StatusColorConverter"/>
                            <converters:BoolToColorConverter  x:Key="BoolToColorConverter"/>
                            <converters:InverseBoolConverter  x:Key="InverseBoolConverter"/>

                            <Style TargetType="components:HeaderComponent" x:Key="HeaderStyle">
                                <Style.Triggers>
                                    <DataTrigger TargetType="components:HeaderComponent"
                             Binding="{Binding Source={RelativeSource AncestorType={x:Type Grid}}, Path=Width}"
                             Value="0">
                                        <Setter Property="IsVisible" Value="True"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </ContentPage.Resources>
</ContentPage>
